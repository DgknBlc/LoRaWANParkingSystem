<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>LoRaWAN Akıllı Park Sistemi</title>
	<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
	<link href="https://api.mapbox.com/mapbox-gl-js/v2.3.0/mapbox-gl.css" rel="stylesheet">
	<script src="https://api.mapbox.com/mapbox-gl-js/v2.3.0/mapbox-gl.js"></script>

	<style>
		body {
			margin: 0;
			padding: 0;
		}

		#map {
			position: absolute;
			top: 0;
			bottom: 0;
			width: 100%;
		}
	</style>
</head>

<body>


	<div id="map"></div>

	<script src="https://unpkg.com/es6-promise@4.2.4/dist/es6-promise.auto.min.js"></script>
	<script src="https://unpkg.com/@mapbox/mapbox-sdk/umd/mapbox-sdk.min.js"></script>
	<script>
		var	konum1=[36.26267693406108, 41.341548855114];
		var konum2=[36.260460555302664, 41.342952802563374];
		var konum3=[36.26143543050793, 41.342191291344776];
		var renk1;
		var renk2;
		var renk3;
		let url2 = 'https://api.thingspeak.com/channels/1380146/fields/1/last.json?api_key=U09E9TP3T8NQSGHN';

		fetch(url2)
			.then(res => res.json())
			.then((out) => {
				console.log('Checkout this JSON! ', Math.floor(out.field1/1000));

				if (Math.floor(out.field1/1000)== 2) {
					renk1 = "#f01818";
				}
				else if(Math.floor(out.field1/1000)== 1) {
					renk1 = "#34c754";
				}
				
				else if (Math.floor(out.field1/1000)== 2) {
					renk2 = "#34c754";
				}
				else if(Math.floor(out.field1/1000)== 1) {
					renk2 = "#f01818";
				}
				else if (Math.floor(out.field1/1000)== 2) {
					renk3 = "#34c754";
				}
				else if(Math.floor(out.field1/1000)== 1) {
					renk3 = "#f01818";
				}

				if(out.field1%1000==568){
					if (Math.floor(out.field1/1000)== 2) {
					renk1 = "#f01818";
					}
					else if(Math.floor(out.field1/1000)== 1) {
					renk1 = "#34c754";
					}
				}
				else if(out.field1%1000==272){
					if (Math.floor(out.field1/1000)== 2) {
					renk2 = "#f01818";
					}
					else if(Math.floor(out.field1/1000)== 1) {
					renk2 = "#34c754";
				}				
				}
				else if(out.field1%1000==251){
					if (Math.floor(out.field1/1000)== 2) {
					renk3 = "#f01818";
					}
					else if(Math.floor(out.field1/1000)== 1) {
					renk3 = "#34c754";
					}				
			}

				mapboxgl.accessToken = 'pk.eyJ1IjoiZGF2b3QxMzY5NSIsImEiOiJja3BiYmR4YzQxMTVvMm9tcHBiNW80cm1yIn0.4AoItntaVis_s_-MJzUfOw';
				var mapboxClient = mapboxSdk({ accessToken: mapboxgl.accessToken });
				mapboxClient.geocoding
					.forwardGeocode({
						query: 'Atakum,Samsun',
						autocomplete: false,
						limit: 1
					})
					.send()
					.then(function (response) {
						if (
							response &&
							response.body &&
							response.body.features &&
							response.body.features.length
						) {
							var feature = response.body.features[0];

							var map = new mapboxgl.Map({
								container: 'map',
								style: 'mapbox://styles/mapbox/streets-v11',
								center: [36.260682, 41.342564],
								zoom: 15
							});
							console.log(renk1);
							// Set options
							var marker1 = new mapboxgl.Marker({
								color: renk1,
								draggable: false
							}).setLngLat(konum1)
								.addTo(map);

							var marker2 = new mapboxgl.Marker({
								color: renk2,
								draggable: false
							}).setLngLat(konum2)
								.addTo(map);

							var marker3 = new mapboxgl.Marker({
								color: renk3,
								draggable: false
							}).setLngLat(konum3)
								.addTo(map);

							// Create a marker and add it to the map.

						}
					});
			}

			)
			.catch(err => { throw err });


	</script>

</body>

</html>
